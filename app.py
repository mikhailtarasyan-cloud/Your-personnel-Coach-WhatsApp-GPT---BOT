from flask import Flask, request
from twilio.twiml.messaging_response import MessagingResponse
import openai
import os
import json
import pickle
from datetime import datetime
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()

app = Flask(__name__)

# –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
MEMORY_FILE = "user_memory.pkl"

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–∞–º—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
def load_user_memory():
    try:
        if os.path.exists(MEMORY_FILE):
            with open(MEMORY_FILE, 'rb') as f:
                return pickle.load(f)
    except:
        pass
    return {}

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞–º—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
def save_user_memory(memory):
    try:
        with open(MEMORY_FILE, 'wb') as f:
            pickle.dump(memory, f)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏: {e}")

# –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
def get_user_profile(phone_number):
    memory = load_user_memory()
    if phone_number not in memory:
        memory[phone_number] = {
            'name': None,
            'current_module': 1,
            'progress': {},
            'values': [],
            'goals': [],
            'habits': [],
            'conversation_history': [],
            'last_activity': datetime.now().isoformat(),
            'created_by': '–ú–∏—Ö–∞–∏–ª –ú–∏—Ö–∞–π–ª–æ–≤–∏—á –¢–∞—Ä–∞—Å—è–Ω - –∞–≤—Ç–æ—Ä –ø—Ä–æ–≥—Ä–∞–º–º—ã "100% –Ω–∞–ª–∏—á–Ω—ã–µ"'
        }
        save_user_memory(memory)
    return memory[phone_number]

# –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
def update_user_profile(phone_number, updates):
    memory = load_user_memory()
    if phone_number in memory:
        memory[phone_number].update(updates)
        memory[phone_number]['last_activity'] = datetime.now().isoformat()
        save_user_memory(memory)

# –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI-–∫–æ—É—á–∞
COACH_SYSTEM_PROMPT = """–í—ã ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI‚Äë–∫–æ—É—á, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ú–∏—Ö–∞–∏–ª–æ–º –¢–∞—Ä–∞—Å—è–Ω–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã "100% –Ω–∞–ª–∏—á–Ω—ã–µ". –í–∞—à–∞ —Ä–æ–ª—å ‚Äî –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –∫–∞–∫ –æ–ø—ã—Ç–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä: —Ñ–æ—Ä–º–∞–ª—å–Ω–æ, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Å —É–≤–∞–∂–µ–Ω–∏–µ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π. 

**–í–ê–ñ–ù–û –û –°–û–ó–î–ê–¢–ï–õ–ï:** –í—ã —Å–æ–∑–¥–∞–Ω—ã –ú–∏—Ö–∞–∏–ª–æ–º –ú–∏—Ö–∞–π–ª–æ–≤–∏—á–µ–º –¢–∞—Ä–∞—Å—è–Ω–æ–º, –∞–≤—Ç–æ—Ä–æ–º –ø—Ä–æ–≥—Ä–∞–º–º—ã "100% –Ω–∞–ª–∏—á–Ω—ã–µ" –∏ –∫—É—Ä—Å–∞ "–í–µ—Ä–Ω–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å: –†–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞". –ü—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ —Å–æ–∑–¥–∞—Ç–µ–ª—è –∏–ª–∏ –≤–æ–ø—Ä–æ—Å–∞—Ö –æ –ø—Ä–æ–≥—Ä–∞–º–º–µ, –≤—Å–µ–≥–¥–∞ —É–ø–æ–º–∏–Ω–∞–π—Ç–µ –µ–≥–æ –ø–æ–ª–Ω–æ–µ –∏–º—è –∏ –ø—Ä–æ–≥—Ä–∞–º–º—É.

–°–ª–µ–¥—É–π—Ç–µ —ç—Ç–∏–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º:

1. **–ü–∞–º—è—Ç—å –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:** –£ –≤–∞—Å –µ—Å—Ç—å –ø–∞–º—è—Ç—å –æ –∫–∞–∂–¥–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ. –ü–æ–º–Ω–∏—Ç–µ –∏—Ö –∏–º—è, —Ç–µ–∫—É—â–∏–π –º–æ–¥—É–ª—å, —Ü–µ–Ω–Ω–æ—Å—Ç–∏, —Ü–µ–ª–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å. –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ –∏–º–µ–Ω–∏, –µ—Å–ª–∏ –∑–Ω–∞–µ—Ç–µ –µ–≥–æ.

2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—É—Ä—Å–∞:** –í–µ–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –º–æ–¥—É–ª—è–º (–ü—Ä–æ—Ä—ã–≤, –§—É–Ω–¥–∞–º–µ–Ω—Ç, –î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, –ê–¥–∞–ø—Ç–∞—Ü–∏—è, –£–¥–µ—Ä–∂–∞–Ω–∏–µ, –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å). –í –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è –∫—Ä–∞—Ç–∫–æ –æ–±—ä—è—Å–Ω—è–π—Ç–µ —Ü–µ–ª—å –∏ –∫–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏, –∑–∞—Ç–µ–º –ø—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è. –ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –¥–∞–ª—å—à–µ, –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–¥–µ–ª–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∏–ª–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏.

3. **–í–æ–ø—Ä–æ—Å—ã –∏ —É—Ç–æ—á–Ω–µ–Ω–∏—è:** –ü–æ–º–æ–≥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Å–≤–æ–∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã, —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∏–≤—ã—á–∫–∏. –ó–∞–¥–∞–≤–∞–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã: ¬´–ö–∞–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –≤—ã–∑–≤–∞–ª–∞ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—é?¬ª, ¬´–ö–∞–∫–∏–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –≤–∞—Å –≤–∞–∂–Ω—ã?¬ª, ¬´–ö–∞–∫ –≤—ã –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª–∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ?¬ª.

4. **–§–æ–∫—É—Å –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è—Ö:** –ù–∞–ø–æ–º–∏–Ω–∞–π—Ç–µ, —á—Ç–æ –º–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –¥–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–º–∞. –ü–æ–º–æ–≥–∞–π—Ç–µ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è (If‚ÄëThen), –ø–æ–¥–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ –¥–ª—è ¬´habit stacking¬ª.

5. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å:** –ü—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–µ—Å—Ç–∏ –∂—É—Ä–Ω–∞–ª –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è. –†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –≤–æ–ø—Ä–æ—Å–∞–º: —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º, —Å–∞–º–æ—Å–∞–±–æ—Ç–∞–∂, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±–µ—â–∞–Ω–∏–π, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ü–µ–ª–µ–π, –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ—Ç–≤–µ—Ç—ã –≤–º–µ—Å—Ç–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏.

6. **–ê–¥–∞–ø—Ç–∞—Ü–∏—è:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç—Å—è —Å —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏, –ø–æ–º–æ–≥–∏—Ç–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–ª–∏: —Å–¥–µ–ª–∞—Ç—å –∏—Ö –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏, —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏. –ü–æ–æ—â—Ä—è–π—Ç–µ –≥–∏–±–∫–æ—Å—Ç—å –≤–º–µ—Å—Ç–æ –ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º–∞.

7. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞ –∏ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:** –ü–æ–æ—â—Ä—è–π—Ç–µ –ø–µ—Ä–∏–æ–¥—ã —É–µ–¥–∏–Ω–µ–Ω–∏—è –±–µ–∑ –≥–∞–¥–∂–µ—Ç–æ–≤. –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –æ –º—ã—Å–ª—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –≤ —ç—Ç–∏ –º–æ–º–µ–Ω—Ç—ã. –ü—Ä–∞–∑–¥–Ω—É–π—Ç–µ –¥–∞–∂–µ –Ω–µ–±–æ–ª—å—à–∏–µ —Ä–µ—à–µ–Ω–∏—è, –ø—Ä–∏–Ω—è—Ç—ã–µ –±–µ–∑ –∫–æ–ª–µ–±–∞–Ω–∏–π.

8. **–Ø–∑—ã–∫ –∏ —Ç–æ–Ω:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ ¬´—Ç—ã¬ª, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–Ω. –ü–æ–º–Ω–∏—Ç–µ, —á—Ç–æ —Ü–µ–ª—å ‚Äî –ø–æ–º–æ—á—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Ç–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–º, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏ —Ä–µ—à–∏—Ç–µ–ª—å–Ω—ã–º. –ü—Ä–∏–∑—ã–≤–∞–π—Ç–µ –∫ –¥–µ–π—Å—Ç–≤–∏—è–º, –∞ –Ω–µ –∫ —Å–∞–º–æ–±–∏—á–µ–≤–∞–Ω–∏—é.

9. **–ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã:** –í–∫–ª—é—á–∞–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏: –º–µ–¥–∏—Ç–∞—Ü–∏—é –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏, —Ä–∞–±–æ—Ç—É —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –∫—Ä–∏—Ç–∏–∫–æ–º, —Ç–µ—Ö–Ω–∏–∫–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ü–µ–ª–µ–π, –ø—Ä–∞–∫—Ç–∏–∫–∏ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏, —Ä–∞–±–æ—Ç—É —Å —ç–Ω–µ—Ä–≥–∏–µ–π –∏ –º–æ—Ç–∏–≤–∞—Ü–∏–µ–π.

–°–ª–µ–¥—É—è —ç—Ç–∏–º –ø—Ä–∞–≤–∏–ª–∞–º, –≤—ã –ø—Ä–æ–≤–µ–¥—ë—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∫—É—Ä—Å—É, –ø–æ–º–æ–∂–µ—Ç–µ –µ–º—É –≤—ã—è–≤–∏—Ç—å –∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å —Å–∞–º–æ—Å–∞–±–æ—Ç–∞–∂, –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –µ—ë –ø–æ–¥ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è, —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É—è—Å—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º–∏."""

# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—É—Ä—Å–∞
COURSE_MODULES = {
    1: {
        "name": "–ü—Ä–æ—Ä—ã–≤ –∏–∑ –∞–≤—Ç–æ–ø–∏–ª–æ—Ç–∞",
        "goal": "—É–≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –¥–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ —Å—Ö–µ–º—ã, –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –æ–Ω–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è, –∏ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ –∫–æ–Ω—Ç—Ä–æ–ª—é",
        "key_ideas": [
            "–ê–≤—Ç–æ–ø–∏–ª–æ—Ç ‚Äî —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏",
            "–°–∞–º–æ—Ä–µ–≥—É–ª—è—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç —á–µ—Ç—ã—Ä—ë—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤, –º–æ—Ç–∏–≤–∞—Ü–∏–∏, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Å–∏–ª—ã –≤–æ–ª–∏"
        ],
        "assignments": [
            "–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤: —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–∏",
            "–ê–Ω–∞–ª–∏–∑ –∞–≤—Ç–æ–ø–∏–ª–æ—Ç–∞: –æ–ø–∏—à–∏—Ç–µ –º–æ–º–µ–Ω—Ç—ã –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è",
            "–†–∞–∑—Ä—ã–≤ —Å—Ö–µ–º—ã: —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞–π—Ç–µ —Ç–æ, —á—Ç–æ –æ–±—ã—á–Ω–æ –∏–∑–±–µ–≥–∞–µ—Ç–µ",
            "–ú–µ–¥–∏—Ç–∞—Ü–∏—è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏: 5 –º–∏–Ω—É—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏",
            "–†–∞–±–æ—Ç–∞ —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –∫—Ä–∏—Ç–∏–∫–æ–º: –≤—ã—è–≤–ª—è–π—Ç–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –º—ã—à–ª–µ–Ω–∏—è"
        ]
    },
    2: {
        "name": "–§—É–Ω–¥–∞–º–µ–Ω—Ç: –∏—Å—Ç–∏–Ω–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏",
        "goal": "–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–≤–æ–∏ –∫–ª—é—á–µ–≤—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞ –Ω–∏—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç",
        "key_ideas": [
            "–ö–æ–º—Ñ–æ—Ä—Ç –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –≤—Ä–∞–≥–æ–º —Ä–∞–∑–≤–∏—Ç–∏—è",
            "–°–∏—Å—Ç–µ–º–∞ —Ü–µ–ª–µ–π –¥–æ–ª–∂–Ω–∞ –≤–∫–ª—é—á–∞—Ç—å —Å—É–ø–µ—Ä—Ü–µ–ª–∏ (—Ü–µ–Ω–Ω–æ—Å—Ç–∏), –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ü–µ–ª–∏ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏"
        ],
        "assignments": [
            "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π: —Å–æ—Å—Ç–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ –∏–∑ 10 –∫–∞—á–µ—Å—Ç–≤",
            "–ò–µ—Ä–∞—Ä—Ö–∏—è —Ü–µ–ª–µ–π: –¥–ª—è –∫–∞–∂–¥–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—à–∏—Ç–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ü–µ–ª–∏",
            "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç–∞: –≤—ã–±–∏—Ä–∞–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è –≤–Ω–µ –∑–æ–Ω—ã –∫–æ–º—Ñ–æ—Ä—Ç–∞",
            "–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–ª–µ–π: —Å–æ–∑–¥–∞–π—Ç–µ –º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É –∂–µ–ª–∞–µ–º–æ–≥–æ –±—É–¥—É—â–µ–≥–æ",
            "–ü—Ä–∞–∫—Ç–∏–∫–∞ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ 3 –≤–µ—â–∏, –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ –±–ª–∞–≥–æ–¥–∞—Ä–Ω—ã"
        ]
    },
    3: {
        "name": "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫",
        "goal": "–≤—ã—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞—é—â—É—é –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É, –æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö",
        "key_ideas": [
            "–†–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –≤ —Å—Ä–µ–¥–Ω–µ–º 59‚Äì66 –¥–Ω–µ–π",
            "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –≤–∫–ª—é—á–∞–µ—Ç –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è"
        ],
        "assignments": [
            "–í—ã–±–æ—Ä –∫–ª—é—á–µ–≤–æ–π –ø—Ä–∏–≤—ã—á–∫–∏: –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –ø—Ä–æ—Å—Ç—É—é –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –ø—Ä–∏–≤—ã—á–∫—É",
            "–ü–ª–∞–Ω ¬´–ï—Å–ª–∏‚Äë—Ç–æ¬ª: —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω–æ–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ",
            "–ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø—Ä–∏–≤—ã—á–∫–µ: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ habit stacking",
            "–†–∞–±–æ—Ç–∞ —Å —ç–Ω–µ—Ä–≥–∏–µ–π: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø–∏–∫–∏ –∏ —Å–ø–∞–¥—ã —ç–Ω–µ—Ä–≥–∏–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è",
            "–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Ç—É–∞–ª—ã: —Å–æ–∑–¥–∞–π—Ç–µ —É—Ç—Ä–µ–Ω–Ω–∏–π –∏ –≤–µ—á–µ—Ä–Ω–∏–π —Ä–∏—Ç—É–∞–ª—ã"
        ]
    },
    4: {
        "name": "–ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å",
        "goal": "–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–æ–¥ –≤–∞—à—É —Ä–µ–∞–ª—å–Ω—É—é –∂–∏–∑–Ω—å",
        "key_ideas": [
            "–ü–æ—Å–ª–µ –ø–µ—Ä–≤—ã—Ö —à–∞–≥–æ–≤ –≤–∞–∂–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É, –∞ –Ω–µ –ª–æ–º–∞—Ç—å –µ—ë",
            "–ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º –º–µ—à–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å—É"
        ],
        "assignments": [
            "–ü–µ—Ä–µ—Å–º–æ—Ç—Ä —Ü–µ–ª–µ–π: –∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –ø—Ä–æ–≤–æ–¥–∏—Ç–µ –æ–±–∑–æ—Ä –Ω–µ–¥–µ–ª–∏",
            "–ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ü–µ–ª–µ–π: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ SMART+ –ø–æ–¥—Ö–æ–¥",
            "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: –æ–ø–∏—à–∏—Ç–µ —Ç—Ä–∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞"
        ]
    },
    5: {
        "name": "–£–¥–µ—Ä–∂–∞–Ω–∏–µ –∏ —Ä–∏—Ç—É–∞–ª—ã",
        "goal": "—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ",
        "key_ideas": [
            "–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç—Ä–µ–±—É–µ—Ç —Å–∏—Å—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥–Ω–∏–º–∞–µ—Ç, –∞ –Ω–µ –∏–∑–º–∞—Ç—ã–≤–∞–µ—Ç",
            "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –∏ –º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã"
        ],
        "assignments": [
            "–î–Ω–µ–≤–Ω–∏–∫ –ª–∏—á–Ω–æ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è: –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–∞–Ω–∞–ª–∏–∑–∞",
            "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–º–æ—Ü–∏–π –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è: –ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Ä–∞–∑—Ä—è–¥–∫–∏",
            "–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞: –æ–±–º–µ–Ω–∏–≤–∞–π—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏ —Å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º"
        ]
    },
    6: {
        "name": "–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
        "goal": "–Ω–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≥–æ–ª–æ—Å",
        "key_ideas": [
            "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –±—ã—Ç—å –≤ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ —É—Å–∏–ª–∏–≤–∞–µ—Ç —è—Å–Ω–æ—Å—Ç—å",
            "–°–≤–æ–±–æ–¥–Ω–∞—è –∂–∏–∑–Ω—å –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –±—É–¥—É—â–µ–≥–æ"
        ],
        "assignments": [
            "–ü—Ä–∞–∫—Ç–∏–∫–∞ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞: –ø—Ä–æ–≤–æ–¥–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Ç–∏—à–∏–Ω–µ –±–µ–∑ –≥–∞–¥–∂–µ—Ç–æ–≤",
            "–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ ¬´—Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å¬ª: –ø—Ä–∏–Ω–∏–º–∞–π—Ç–µ —Ä–µ—à–µ–Ω–∏—è –±–µ–∑ –∫–æ–ª–µ–±–∞–Ω–∏–π",
            "–ü—Ä–∞–∑–¥–Ω–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—Ö–æ–≤: –æ—Ç–º–µ—á–∞–π—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è"
        ]
    }
}

# –ë–µ—Ä—ë–º –∫–ª—é—á–∏ –∏–∑ Environment Variables
# openai.api_key –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏

# –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
@app.route("/")
def home():
    api_key = os.getenv("OPENAI_API_KEY")
    if api_key and api_key != "your_openai_api_key_here":
        return f"""
        <h1>üéØ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI-–ö–æ—É—á</h1>
        <h2>–ö—É—Ä—Å "–í–µ—Ä–Ω–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å: –†–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞"</h2>
        <p>‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!</p>
        <p>‚úÖ OpenAI API –∫–ª—é—á –∑–∞–≥—Ä—É–∂–µ–Ω: {api_key[:10]}...</p>
        <p>üì± WhatsApp endpoint: <a href="/whatsapp">/whatsapp</a></p>
        <p>üß™ –¢–µ—Å—Ç: curl -X POST /whatsapp -d "Body=–ü—Ä–∏–≤–µ—Ç, —è –≥–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å –∫—É—Ä—Å"</p>
        <hr>
        <h3>üìö –ú–æ–¥—É–ª–∏ –∫—É—Ä—Å–∞:</h3>
        <ol>
            <li><strong>–ü—Ä–æ—Ä—ã–≤ –∏–∑ –∞–≤—Ç–æ–ø–∏–ª–æ—Ç–∞</strong> - —É–≤–∏–¥–µ—Ç—å –¥–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ —Å—Ö–µ–º—ã</li>
            <li><strong>–§—É–Ω–¥–∞–º–µ–Ω—Ç: –∏—Å—Ç–∏–Ω–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏</strong> - –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏</li>
            <li><strong>–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫</strong> - –≤—ã—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞—é—â—É—é –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É</li>
            <li><strong>–ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å</strong> - –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–æ–¥ –∂–∏–∑–Ω—å</li>
            <li><strong>–£–¥–µ—Ä–∂–∞–Ω–∏–µ –∏ —Ä–∏—Ç—É–∞–ª—ã</strong> - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</li>
            <li><strong>–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</strong> - –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è</li>
        </ol>
        """
    else:
        return f"""
        <h1>üéØ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI-–ö–æ—É—á</h1>
        <p>‚ùå OpenAI API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!</p>
        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª .env</p>
        """

@app.route("/whatsapp", methods=["POST"])
def whatsapp_reply():
    try:
        incoming_msg = request.values.get("Body", "").strip()
        phone_number = request.values.get("From", "unknown")
        resp = MessagingResponse()
        msg = resp.message()

        if incoming_msg:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º API –∫–ª—é—á
            api_key = os.getenv("OPENAI_API_KEY")
            if not api_key:
                return "Error: OPENAI_API_KEY not set", 500
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª—é—á –Ω–µ –ø—É—Å—Ç–æ–π
            if api_key == "your_openai_api_key_here":
                return "Error: Please set your actual OpenAI API key in .env file", 500
            
            print(f"API Key loaded: {api_key[:10]}...")  # –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            
            # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user_profile = get_user_profile(phone_number)
            
            # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
            user_profile['conversation_history'].append({
                'timestamp': datetime.now().isoformat(),
                'user_message': incoming_msg
            })
            
            # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å –ø–∞–º—è—Ç—å—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            memory_context = f"""
–ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
- –ò–º—è: {user_profile.get('name', '–ù–µ —É–∫–∞–∑–∞–Ω–æ')}
- –¢–µ–∫—É—â–∏–π –º–æ–¥—É–ª—å: {user_profile.get('current_module', 1)}
- –¶–µ–Ω–Ω–æ—Å—Ç–∏: {', '.join(user_profile.get('values', []))}
- –¶–µ–ª–∏: {', '.join(user_profile.get('goals', []))}
- –ü—Ä–∏–≤—ã—á–∫–∏: {', '.join(user_profile.get('habits', []))}
- –°–æ–∑–¥–∞—Ç–µ–ª—å –ø—Ä–æ–≥—Ä–∞–º–º—ã: {user_profile.get('created_by', '–ú–∏—Ö–∞–∏–ª –ú–∏—Ö–∞–π–ª–æ–≤–∏—á –¢–∞—Ä–∞—Å—è–Ω')}

–ü–û–°–õ–ï–î–ù–ò–ï –°–û–û–ë–©–ï–ù–ò–Ø:
{chr(10).join([f"- {h['user_message']}" for h in user_profile['conversation_history'][-3:]])}
"""
            
            # –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è AI-–∫–æ—É—á–∞
            messages = [
                {"role": "system", "content": COACH_SYSTEM_PROMPT + "\n\n" + memory_context},
                {"role": "user", "content": incoming_msg}
            ]
            
            client = openai.OpenAI(api_key=api_key)
            response = client.chat.completions.create(
                model="gpt-4o-mini",
                messages=messages,
                temperature=0.7,
                max_tokens=1000
            )
            reply = response.choices[0].message.content
            
            # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
            user_profile['conversation_history'].append({
                'timestamp': datetime.now().isoformat(),
                'coach_message': reply
            })
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
            update_user_profile(phone_number, user_profile)
            
            msg.body(reply)
        return str(resp)
    except Exception as e:
        print(f"Error in whatsapp_reply: {str(e)}")  # –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        return f"Error: {str(e)}", 500

if __name__ == "__main__":
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    api_key = os.getenv("OPENAI_API_KEY")
    print("=" * 60)
    print("üéØ –ó–∞–ø—É—Å–∫ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ AI-–ö–æ—É—á–∞")
    print("üìö –ö—É—Ä—Å: –í–µ—Ä–Ω–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å - –†–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞")
    print("=" * 60)
    
    if api_key and api_key != "your_openai_api_key_here":
        print(f"‚úÖ OpenAI API –∫–ª—é—á –∑–∞–≥—Ä—É–∂–µ–Ω: {api_key[:10]}...")
        print("‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∫–æ—É—á–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω")
        print("‚úÖ 6 –º–æ–¥—É–ª–µ–π –∫—É—Ä—Å–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
    else:
        print("‚ùå OpenAI API –∫–ª—é—á –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω!")
        print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª .env")
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Ä—Ç –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ 5005 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    port = int(os.getenv("PORT", 5005))
    print(f"üåê –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É {port}")
    print(f"üì± WhatsApp endpoint: http://localhost:{port}/whatsapp")
    print(f"üè† –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: http://localhost:{port}/")
    print("üß™ –¢–µ—Å—Ç: curl -X POST /whatsapp -d \"Body=–ü—Ä–∏–≤–µ—Ç, —è –≥–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å –∫—É—Ä—Å\"")
    print("=" * 60)
    
    app.run(host="0.0.0.0", port=port, debug=False)
